# ==============================================
# ã€æˆ˜ç•¥å‹æœé‚¦åˆ†æè®¡ç®—å™¨ã€‘v1.0
# ç‹¬ç‰¹æ€§ï¼šé©±åŠ¨å› ç´ é›·è¾¾å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰+ æˆ˜ç•¥ç±»å‹åˆ¤æ–­ + è¡Œä¸šæ ‡æ†å¯¹æ¯”
# å¼€å‘è€…ï¼šKiwi_hazel
# å…¬å¼æ¥æºï¼šCFAäºŒçº§æ•™æP189ï¼ˆæœé‚¦ä¸‰åˆ†è§£ï¼šROE = å‡€åˆ©ç‡ Ã— èµ„äº§å‘¨è½¬ç‡ Ã— æƒç›Šä¹˜æ•°ï¼‰
# ==============================================

def analyze_dupont(net_profit, revenue, avg_assets, avg_equity, industry):
    """
    æ ¸å¿ƒåŠŸèƒ½ï¼šè®¡ç®—ROEä¸‰å› ç´ å¹¶è¾“å‡ºæˆ˜ç•¥è§£è¯»
    :param industry: è¡Œä¸šç±»å‹ï¼ˆç§‘æŠ€ä¸š/é›¶å”®ä¸š/åˆ¶é€ ä¸šï¼‰
    """
    # åŸºç¡€æ ¡éªŒï¼ˆè´¢åŠ¡æ•°æ®å¿…é¡»ä¸ºæ­£ï¼‰
    if net_profit <= 0 or revenue <= 0 or avg_assets <= 0 or avg_equity <= 0:
        return {"error": "âš ï¸ è¾“å…¥é”™è¯¯ï¼šå‡€åˆ©æ¶¦ã€è¥æ”¶ã€èµ„äº§ã€æƒç›Šéœ€>0ï¼ˆè´¢åŠ¡æ•°æ®é€»è¾‘æ ¡éªŒï¼‰"}
    
    # è®¡ç®—ä¸‰å› ç´ ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
    å‡€åˆ©ç‡ = round((net_profit / revenue) * 100, 2)  # %
    èµ„äº§å‘¨è½¬ç‡ = round(revenue / avg_assets, 2)       # æ¬¡/å¹´
    æƒç›Šä¹˜æ•° = round(avg_assets / avg_equity, 2)      # å€
    ROE = round(å‡€åˆ©ç‡ * èµ„äº§å‘¨è½¬ç‡ * æƒç›Šä¹˜æ•° / 100, 2)  # åˆæˆROE
    
    # ----------------------
    # ç‚¹1ï¼šé©±åŠ¨å› ç´ é›·è¾¾å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰
    # ----------------------
    è¡Œä¸šåŸºå‡† = {
        "ç§‘æŠ€ä¸š": {"å‡€åˆ©ç‡": 15.0, "èµ„äº§å‘¨è½¬ç‡": 1.2, "æƒç›Šä¹˜æ•°": 1.5},  # é«˜åˆ©æ¶¦ä½å‘¨è½¬
        "é›¶å”®ä¸š": {"å‡€åˆ©ç‡": 3.0, "èµ„äº§å‘¨è½¬ç‡": 3.0, "æƒç›Šä¹˜æ•°": 2.0},   # ä½åˆ©æ¶¦é«˜å‘¨è½¬
        "åˆ¶é€ ä¸š": {"å‡€åˆ©ç‡": 8.0, "èµ„äº§å‘¨è½¬ç‡": 1.8, "æƒç›Šä¹˜æ•°": 2.5}    # å‡è¡¡å‹
    }
    åŸºå‡† = è¡Œä¸šåŸºå‡†.get(industry, è¡Œä¸šåŸºå‡†["åˆ¶é€ ä¸š"])  # é»˜è®¤åˆ¶é€ ä¸š
    
    # ç”¨ç®­å¤´è¡¨ç¤ºä¸è¡Œä¸šåŸºå‡†çš„å·®å¼‚ï¼ˆâ†‘é«˜äº â†“ä½äº â†’ æŒå¹³ï¼‰
    å‡€åˆ©ç‡è¶‹åŠ¿ = "â†‘" if å‡€åˆ©ç‡ > åŸºå‡†["å‡€åˆ©ç‡"] * 1.1 else "â†“" if å‡€åˆ©ç‡ < åŸºå‡†["å‡€åˆ©ç‡"] * 0.9 else "â†’"
    å‘¨è½¬ç‡è¶‹åŠ¿ = "â†‘" if èµ„äº§å‘¨è½¬ç‡ > åŸºå‡†["èµ„äº§å‘¨è½¬ç‡"] * 1.1 else "â†“" if èµ„äº§å‘¨è½¬ç‡ < åŸºå‡†["èµ„äº§å‘¨è½¬ç‡"] * 0.9 else "â†’"
    æ æ†è¶‹åŠ¿ = "â†‘" if æƒç›Šä¹˜æ•° > åŸºå‡†["æƒç›Šä¹˜æ•°"] * 1.1 else "â†“" if æƒç›Šä¹˜æ•° < åŸºå‡†["æƒç›Šä¹˜æ•°"] * 0.9 else "â†’"
    
    # ----------------------
    # ç‚¹2ï¼šæˆ˜ç•¥ç±»å‹åˆ¤æ–­
    # ----------------------
    if å‡€åˆ©ç‡ > è¡Œä¸šåŸºå‡†[industry]["å‡€åˆ©ç‡"] * 1.5:
        æˆ˜ç•¥ç±»å‹ = "ã€é«˜åˆ©æ¶¦å‹ã€‘"  # å¦‚å¥¢ä¾ˆå“ã€ç§‘æŠ€å…¬å¸
        æˆ˜ç•¥è§£è¯» = "ä¼˜åŠ¿ï¼šå“ç‰Œæº¢ä»·é«˜ï¼ŒæŠ—å‘¨æœŸèƒ½åŠ›å¼ºï¼›é£é™©ï¼šéœ€æŒç»­æŠ•å…¥ç ”å‘/è¥é”€ç»´æŒæº¢ä»·"
    elif èµ„äº§å‘¨è½¬ç‡ > è¡Œä¸šåŸºå‡†[industry]["èµ„äº§å‘¨è½¬ç‡"] * 1.5:
        æˆ˜ç•¥ç±»å‹ = "ã€é«˜å‘¨è½¬å‹ã€‘"  # å¦‚é›¶å”®ã€å¿«æ¶ˆå“
        æˆ˜ç•¥è§£è¯» = "ä¼˜åŠ¿ï¼šè½»èµ„äº§è¿è¥ï¼Œç°é‡‘æµå¥åº·ï¼›é£é™©ï¼šä¾èµ–ä¾›åº”é“¾æ•ˆç‡ï¼Œæ˜“å—ä»·æ ¼æˆ˜å½±å“"
    elif æƒç›Šä¹˜æ•° > è¡Œä¸šåŸºå‡†[industry]["æƒç›Šä¹˜æ•°"] * 1.5:
        æˆ˜ç•¥ç±»å‹ = "ã€é«˜æ æ†å‹ã€‘"  # å¦‚é‡‘èã€æˆ¿åœ°äº§
        æˆ˜ç•¥è§£è¯» = "ä¼˜åŠ¿ï¼šæ”¾å¤§ROEï¼Œé€‚åˆä½é£é™©ç¨³å®šè¡Œä¸šï¼›é£é™©ï¼šåˆ©ç‡ä¸Šå‡æˆ–èµ„äº§è´¬å€¼æ—¶å‹åŠ›å¤§"
    else:
        æˆ˜ç•¥ç±»å‹ = "ã€å‡è¡¡å‹ã€‘"
        æˆ˜ç•¥è§£è¯» = "ä¼˜åŠ¿ï¼šä¸‰å› ç´ ååŒå‘å±•ï¼›é£é™©ï¼šéœ€è­¦æƒ•å„å› ç´ æ— äº®ç‚¹å¯¼è‡´ROEå¹³åº¸"
    
    return {
        "roe": ROE,
        "factors": {"å‡€åˆ©ç‡(%)": å‡€åˆ©ç‡, "èµ„äº§å‘¨è½¬ç‡(æ¬¡)": èµ„äº§å‘¨è½¬ç‡, "æƒç›Šä¹˜æ•°(å€)": æƒç›Šä¹˜æ•°},
        "radar": f"é©±åŠ¨å› ç´ è¶‹åŠ¿ï¼šå‡€åˆ©ç‡{å‡€åˆ©ç‡è¶‹åŠ¿} å‘¨è½¬ç‡{å‘¨è½¬ç‡è¶‹åŠ¿} æ æ†{æ æ†è¶‹åŠ¿}",
        "strategy_type": æˆ˜ç•¥ç±»å‹,
        "strategy_note": æˆ˜ç•¥è§£è¯»,
        "industry": industry
    }

# ----------------------
# æç®€äº¤äº’ï¼ˆ3æ­¥è¾“å…¥+å¡ç‰‡è¾“å‡ºï¼‰
# ----------------------
if __name__ == "__main__":
    print("\n===== ğŸ“Š æˆ˜ç•¥å‹æœé‚¦åˆ†æè®¡ç®—å™¨ =====")
    print("â†’ ç‹¬ç‰¹åŠŸèƒ½ï¼šä¸ä»…ç®—ROEï¼Œè¿˜æ­ç¤ºé©±åŠ¨å› ç´ å’Œæˆ˜ç•¥ç±»å‹\n")
    
    # 3æ­¥æ ¸å¿ƒè¾“å…¥ï¼ˆå¸¦è¡Œä¸šç‰¹æ€§æç¤ºï¼‰
    net_profit = float(input("1. å‡€åˆ©æ¶¦ï¼ˆä¸‡å…ƒï¼Œä¾‹ï¼š1200 â†’ ç§‘æŠ€ä¸šå»ºè®®>è¥æ”¶15%ï¼‰ï¼š"))
    revenue = float(input("2. è¥ä¸šæ”¶å…¥ï¼ˆä¸‡å…ƒï¼Œä¾‹ï¼š8000 â†’ é›¶å”®ä¸šå»ºè®®>èµ„äº§3å€ï¼‰ï¼š"))
    avg_assets = float(input("3. å¹³å‡æ€»èµ„äº§ï¼ˆä¸‡å…ƒï¼Œä¾‹ï¼š5000 â†’ åˆ¶é€ ä¸šå»ºè®®å‘¨è½¬ç‡>1.5æ¬¡ï¼‰ï¼š"))
    avg_equity = float(input("4. å¹³å‡å‡€èµ„äº§ï¼ˆä¸‡å…ƒï¼Œä¾‹ï¼š3000ï¼‰ï¼š"))
    industry = input("\n5. è¡Œä¸šç±»å‹ï¼ˆè¾“å…¥æ•°å­—1-3ï¼‰ï¼š1.ç§‘æŠ€ä¸š 2.é›¶å”®ä¸š 3.åˆ¶é€ ä¸š â†’ ")
    industry_map = {"1": "ç§‘æŠ€ä¸š", "2": "é›¶å”®ä¸š", "3": "åˆ¶é€ ä¸š"}
    industry_name = industry_map.get(industry, "åˆ¶é€ ä¸š")
    
    # è®¡ç®—+è¾“å‡ºï¼ˆå¡ç‰‡å¼ç»“æœï¼‰
    result = analyze_dupont(net_profit, revenue, avg_assets, avg_equity, industry_name)
    print(f"\n{'='*50}")
    if "error" in result:
        print(result["error"])
    else:
        print(f"ROEï¼ˆå‡€èµ„äº§æ”¶ç›Šç‡ï¼‰ï¼š{result['roe']}%")
        print(f"ä¸‰å› ç´ åˆ†è§£ï¼š{result['factors']}")
        print(f"è¡Œä¸šå¯¹æ¯”ï¼š{result['radar']}ï¼ˆâ†‘é«˜äºè¡Œä¸š10%ï¼Œâ†“ä½äºè¡Œä¸š10%ï¼Œâ†’ æŒå¹³ï¼‰\n")
        print(f"ğŸ¯ æˆ˜ç•¥ç±»å‹ï¼š{result['strategy_type']}")
        print(f"ğŸ’¡ æˆ˜ç•¥è§£è¯»ï¼š{result['strategy_note']}")
    print(f"\nğŸ“š å…³é”®é€»è¾‘ï¼šROE=å‡€åˆ©ç‡Ã—èµ„äº§å‘¨è½¬ç‡Ã—æƒç›Šä¹˜æ•° â†’ é«˜ROEéœ€è‡³å°‘1ä¸ªå› ç´ çªå‡º")
    print("="*50)
Â 
